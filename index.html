<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ActiveResourceKit: Active Resource Kit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ActiveResourceKit
   &#160;<span id="projectnumber">v1.0&nbsp;(481.0)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Active Resource Kit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>What can you do with Active Resource Kit? Active Resource Kit is yet-another RESTful framework. There are others. But Active Resource Kit has a number of distinct features.</p>
<ol type="1">
<li>It mirrors the Rails Active Resource gem closely. The interface and implementation remain as faithful as an Objective-C implementation can reasonably be to the Ruby-based originals.</li>
<li>It offers a very high-level interface to RESTful resources using Core Data. You can access remote resources just as if they were in a local Core Data store. The implementation uses the new Core Data <code>NSIncrementalStore</code> API to merge the two dissimilar interfaces.</li>
<li>It only has Foundation and Core Data as underlying dependencies. Although it has two immediate dependencies, Active Model Kit and Active Support Kit which fall under the same umbrella framework, Apple's Foundation and Core Data kits form the only <em>external</em> dependencies. The implementation employs only the Foundation framework for network access.</li>
<li>The framework supports various concurrency models when interacting with remote resources: these are the same models offered by Apple's Foundation <code>NSURLConnection</code> class, i.e. delegated URL connections, synchronous loading or queued loading. You can configure according to your requirements on a resource-by-resource basis.</li>
<li>There are no swizzles or other non-standard Objective-C tricks. The framework makes extensive use of C blocks for handling completions for both asynchronous and synchronous interfaces; this simply follows the pattern set by Apple in their URL connection API.</li>
</ol>
<h1><a class="anchor" id="setting_up"></a>
Setting Up an Active Resource-Based Core Data Stack</h1>
<p>This is easy to do. Just follow the usual Core Data-prescribed procedure: load the model, load the coordinator with the model, add the store to the coordinator, and finally attach the coordinator to the context.</p>
<p>See example below. There are some things to especially notice. First, the persistent store type specifies the <code><a class="el" href="interface_a_r_incremental_store.html" title="Core Data incremental store based on active resources.">ARIncrementalStore</a></code> type. The URL specifies the remote resource, its protocol, host and path. Protocol can be <code>http</code>, or <code>https</code> if you want secure transport. The path can specify the site root, i.e. an empty or single-slash path, or can also include a sub-path nested within the remote site. The client-side data model must correspond to the remote's RESTful interface. The Active Resource incremental store utilises the client-side data model in order to deduce the entities, their properties and relationships. Core Data itself requires a valid data model.</p>
<div class="fragment"><div class="line">NSBundle *bundle = [NSBundle bundleForClass:[<span class="keyword">self</span> <span class="keyword">class</span>]];</div>
<div class="line">NSURL *modelURL = [bundle URLForResource:<span class="stringliteral">@&quot;MyCoreDataModel&quot;</span> withExtension:<span class="stringliteral">@&quot;momd&quot;</span>];</div>
<div class="line">NSManagedObjectModel *model = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];</div>
<div class="line">NSPersistentStoreCoordinator *coordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:model];</div>
<div class="line"></div>
<div class="line">NSError *__autoreleasing error = nil;</div>
<div class="line">NSPersistentStore *store = [coordinator addPersistentStoreWithType:[<a class="code" href="interface_a_r_incremental_store.html" title="Core Data incremental store based on active resources.">ARIncrementalStore</a> storeType]</div>
<div class="line">                                                     configuration:nil</div>
<div class="line">                                                               URL:[NSURL URLWithString:<span class="stringliteral">@&quot;http://localhost:3000&quot;</span>]</div>
<div class="line">                                                           options:nil</div>
<div class="line">                                                             error:&amp;error];</div>
<div class="line"><span class="comment">// &lt;-- error handling goes here</span></div>
<div class="line"></div>
<div class="line">NSManagedObjectContext *context = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];</div>
<div class="line">[context setPersistentStoreCoordinator:coordinator];</div>
<div class="line">[<span class="keyword">self</span> setContext:context];</div>
</div><!-- fragment --><p>Note that this excerpt uses Automatic Reference Counting, hence the <code>__autoreleasing</code> specifier for the error pointer. Notice the blatant lack of manual auto-releasing.</p>
<h1><a class="anchor" id="accessing_resources"></a>
Accessing Resources</h1>
<p>You can then access resources using <em>only</em> Core Data.</p>
<div class="fragment"><div class="line">NSError *__autoreleasing error = nil;</div>
<div class="line">NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:<span class="stringliteral">@&quot;Person&quot;</span>];</div>
<div class="line">NSArray *people = [[<span class="keyword">self</span> context] executeFetchRequest:request error:&amp;error];</div>
<div class="line"><span class="keywordflow">for</span> (NSManagedObject *person in people)</div>
<div class="line">{</div>
<div class="line">    NSString *name = [person valueForKey:<span class="stringliteral">@&quot;name&quot;</span>];</div>
<div class="line">    NSLog(<span class="stringliteral">@&quot;person named %@&quot;</span>, name);</div>
<div class="line">}</div>
</div><!-- fragment --><p>You ask Core Data for the <a class="el" href="interface_person.html">Person</a> entities. The answer is a collection of managed object representing each <a class="el" href="interface_person.html">Person</a>. You access attributes on the objects using standard Cocoa key-value coding. However, underneath the hood, the Active Resource incremental store has enacted a RESTful GET request at <a href="http://localhost:3000/people.json,">http://localhost:3000/people.json,</a> decoding and caching the active resources at the client side.</p>
<p>At the other side of the connection (assuming your server runs on Rails; it does not need to be Rails but can be any conforming RESTful interface) you will see a GET request in the server log, as follows. Some details elided. </p>
<div class="fragment"><div class="line">Started GET <span class="stringliteral">&quot;/people.json&quot;</span> <span class="keywordflow">for</span> 127.0.0.1 at …</div>
<div class="line">Processing by PeopleController#index as JSON</div>
<div class="line">  <a class="code" href="interface_person.html">Person</a> Load (0.2ms)  SELECT &quot;people&quot;.* FROM &quot;people&quot;</div>
<div class="line">Completed 200 OK in 5ms (Views: 3.8ms | ActiveRecord: 0.2ms)</div>
</div><!-- fragment --><h2><a class="anchor" id="inserting_resources"></a>
Inserting Resources</h2>
<p>This just becomes fuss-free: </p>
<div class="fragment"><div class="line">NSError *__autoreleasing error = nil;</div>
<div class="line">NSManagedObject *person = [NSEntityDescription insertNewObjectForEntityForName:<span class="stringliteral">@&quot;Person&quot;</span> inManagedObjectContext:[<span class="keyword">self</span> context]];</div>
<div class="line">[person setValue:<span class="stringliteral">@&quot;Roy Ratcliffe&quot;</span> forKey:<span class="stringliteral">@&quot;name&quot;</span>];</div>
<div class="line">BOOL yes = [[<span class="keyword">self</span> context] save:&amp;error];</div>
</div><!-- fragment --><p> And on the server side becomes a familiar POST request: </p>
<div class="fragment"><div class="line">Started POST <span class="stringliteral">&quot;/people.json&quot;</span> <span class="keywordflow">for</span> 127.0.0.1 at …</div>
<div class="line">Processing by PeopleController#create as JSON</div>
<div class="line">  Parameters: {<span class="stringliteral">&quot;person&quot;</span>=&gt;{<span class="stringliteral">&quot;name&quot;</span>=&gt;<span class="stringliteral">&quot;Roy Ratcliffe&quot;</span>}}</div>
<div class="line">   (0.1ms)  begin transaction</div>
<div class="line">  SQL (0.4ms)  INSERT INTO <span class="stringliteral">&quot;people&quot;</span> (<span class="stringliteral">&quot;created_at&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;updated_at&quot;</span>) VALUES (?, ?, ?)  [[<span class="stringliteral">&quot;created_at&quot;</span>, …], [<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Roy Ratcliffe&quot;</span>], [<span class="stringliteral">&quot;updated_at&quot;</span>, …]]</div>
<div class="line">   (2.3ms)  commit transaction</div>
<div class="line">Completed 201 Created in 5ms (Views: 0.8ms | ActiveRecord: 2.8ms)</div>
</div><!-- fragment --><h2><a class="anchor" id="deleting_resources"></a>
Deleting Resources</h2>
<p>Again, just very simply: </p>
<div class="fragment"><div class="line">NSError *__autoreleasing error = nil;</div>
<div class="line">[[<span class="keyword">self</span> context] deleteObject:person];</div>
<div class="line">BOOL yes = [[<span class="keyword">self</span> context] save:&amp;error];</div>
</div><!-- fragment --><p> And the server responds: </p>
<div class="fragment"><div class="line">Started DELETE <span class="stringliteral">&quot;/people/16.json&quot;</span> <span class="keywordflow">for</span> 127.0.0.1 at …</div>
<div class="line">Processing by PeopleController#destroy as JSON</div>
<div class="line">  Parameters: {<span class="stringliteral">&quot;id&quot;</span>=&gt;<span class="stringliteral">&quot;16&quot;</span>}</div>
<div class="line">  <a class="code" href="interface_person.html">Person</a> Load (0.1ms)  SELECT &quot;people&quot;.* FROM &quot;people&quot; WHERE &quot;people&quot;.&quot;<span class="keywordtype">id</span>&quot; = ? LIMIT 1  [[&quot;<span class="keywordtype">id</span>&quot;, &quot;16&quot;]]</div>
<div class="line">   …</div>
<div class="line">  SQL (0.3ms)  DELETE FROM &quot;people&quot; WHERE &quot;people&quot;.&quot;<span class="keywordtype">id</span>&quot; = ?  [[&quot;<span class="keywordtype">id</span>&quot;, 16]]</div>
<div class="line">   …</div>
<div class="line">Completed 200 OK in 15ms (ActiveRecord: 12.7ms)</div>
</div><!-- fragment --><h2><a class="anchor" id="forming_associations"></a>
Forming Associations</h2>
<p>You can conveniently form associations between objects and their remote resources using only the Core Data interface.</p>
<p>The following demonstrates what happens when you instantiate two entities and wire them up entirely at the client side first. Lets say you have a post and comment model; posts have many comments, a one post to many comments association. The following initially creates a post with one comment.</p>
<div class="fragment"><div class="line">NSManagedObject *post = [NSEntityDescription insertNewObjectForEntityForName:<span class="stringliteral">@&quot;Post&quot;</span> inManagedObjectContext:[<span class="keyword">self</span> context]];</div>
<div class="line">NSManagedObject *comment = [NSEntityDescription insertNewObjectForEntityForName:<span class="stringliteral">@&quot;Comment&quot;</span> inManagedObjectContext:[<span class="keyword">self</span> context]];</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set up attributes for the post and the comment.</span></div>
<div class="line">[post setValue:<span class="stringliteral">@&quot;De finibus bonorum et malorum&quot;</span> forKey:<span class="stringliteral">@&quot;title&quot;</span>];</div>
<div class="line">[post setValue:<span class="stringliteral">@&quot;Non eram nescius…&quot;</span> forKey:<span class="stringliteral">@&quot;body&quot;</span>];</div>
<div class="line">[comment setValue:<span class="stringliteral">@&quot;Quae cum dixisset…&quot;</span> forKey:<span class="stringliteral">@&quot;text&quot;</span>];</div>
<div class="line"></div>
<div class="line"><span class="comment">// Form the one-post-to-many-comments association.</span></div>
<div class="line">[comment setValue:post forKey:<span class="stringliteral">@&quot;post&quot;</span>];</div>
<div class="line"></div>
<div class="line"><span class="comment">// Send it all to the server.</span></div>
<div class="line">NSError *__autoreleasing error = nil;</div>
<div class="line">[[<span class="keyword">self</span> context] save:&amp;error];</div>
</div><!-- fragment --><p>It constructs a new post, a new comment and their relationship within the client at first. Then it saves the context in order to transfer the objects and their relationship to the remote server.</p>
<p>Thereafter, you can throw away the comment and refetch it by dereferencing the post's "comments" relationship. The following extract pulls out each text field from the comments based on a given post.</p>
<div class="fragment"><div class="line">NSMutableArray *comments = [NSMutableArray array];</div>
<div class="line"><span class="keywordflow">for</span> (NSManagedObject *comment in [post valueForKey:<span class="stringliteral">@&quot;comments&quot;</span>])</div>
<div class="line">{</div>
<div class="line">   [comments addObject:[comment valueForKey:<span class="stringliteral">@&quot;text&quot;</span>]];</div>
<div class="line">}</div>
<div class="line">[[comments objectAtIndex:0] rangeOfString:<span class="stringliteral">@&quot;Quae cum dixisset&quot;</span>].location != NSNotFound;</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
